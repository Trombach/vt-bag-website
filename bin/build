#! /bin/sh

sed -i 's/showSubResults: true,/showSubResults:true,excerptLength:40,/' node_modules/@astrojs/starlight/components/Search.astro
sed -i 's/slug: PAGE_TITLE_ID/slug: "top"/' node_modules/@astrojs/starlight/utils/generateToC.ts
astro check && astro build
if [ "$?" -ne "0" ]; then
	exit 1
fi
./bin/check_links.sh
[ -n "$GS" ] && echo -n "google-site-verification: ${GS}" > ./dist/${GS}

find dist -type f -exec grep -l 'script src="/chamber.js/"' {} \; | xargs sed -i 's|script src="/chamber.js/"|script src="/chamber.js"|'